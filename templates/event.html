<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>S·ª± Ki·ªán ƒê·∫∑c Bi·ªát - V√≤ng Quay T·ª≠ Th·∫ßn</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .event-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            margin-top: 30px;
            margin-bottom: 30px;
        }
        .event-header {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            color: white;
            padding: 30px;
            border-radius: 20px 20px 0 0;
            text-align: center;
        }
        .prize-item {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .prize-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .wheel-container {
            position: relative;
            width: 420px;
            height: 420px;
            margin: 0 auto;
        }
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(
                /* KH·ªöP V·ªöI SERVER - √î 0 ƒë·∫øn √î 6 */
                #ff6b6b 0deg 51.43deg,           /* √î 0: May m·∫Øn l·∫ßn sau (40%) */
                #4ecdc4 51.43deg 102.86deg,      /* √î 1: May m·∫Øn l·∫ßn sau (25%) */
                #45b7d1 102.86deg 154.29deg,     /* √î 2: May m·∫Øn l·∫ßn sau (15%) */
                #96ceb4 154.29deg 205.72deg,     /* √î 3: 50K VNƒê (10%) */
                #f7dc6f 205.72deg 257.15deg,     /* √î 4: 100K VNƒê (5%) */
                #f8c471 257.15deg 308.58deg,     /* √î 5: 200K VNƒê (3%) */
                #9b59b6 308.58deg 360deg         /* √î 6: 500K VNƒê (2%) */
            );
            position: relative;
            border: 10px solid #ffd700;
            box-shadow: 
                inset 0 0 20px rgba(0,0,0,0.2),
                0 0 25px rgba(0,0,0,0.4);
            transform-origin: center;
            will-change: transform;
            backface-visibility: hidden;
            transition: transform 4.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            transform: rotate(0deg);
        }
        .wheel-pointer {
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%) rotate(180deg);
            width: 40px;
            height: 50px;
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            z-index: 10;
            filter: drop-shadow(0 5px 8px rgba(0,0,0,0.4));
            border-radius: 3px;
        }
        .prize-label {
            position: absolute;
            color: white;
            font-weight: bold;
            font-size: 14px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            transform-origin: center;
            text-align: center;
            width: 90px;
            pointer-events: none;
            user-select: none;
            left: 50%;
            top: 50%;
            white-space: nowrap;
        }
        .prize-label.special {
            color: #ffd700;
            font-size: 11px;
            font-weight: 600;
            width: 100px;
        }
        .participate-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff8e53);
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        .participate-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
        .participate-btn:disabled {
            background: #6c757d;
            transform: none;
            box-shadow: none;
        }
        .event-banner {
            background: linear-gradient(90deg, #ff6b6b, #ff8e53, #ff6b6b);
            background-size: 200% 100%;
            animation: gradientShift 3s ease infinite;
            padding: 15px 0;
            border-bottom: 3px solid #ffd700;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        @keyframes gradientShift {
            0% { background-position: 200% 0%; }
            50% { background-position: 0% 0%; }
            100% { background-position: 200% 0%; }
        }
        .status-card {
            border-left: 5px solid #007bff;
        }
        .status-card.eligible {
            border-left-color: #28a745;
        }
        .status-card.not-eligible {
            border-left-color: #dc3545;
        }
        .status-card.ended {
            border-left-color: #6c757d;
        }
        .spin-count {
            font-size: 14px;
            color: #6c757d;
            margin-top: 10px;
        }
        .result-animation {
            animation: resultPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes resultPop {
            0% { 
                transform: scale(0.3); 
                opacity: 0; 
            }
            70% { 
                transform: scale(1.1); 
            }
            100% { 
                transform: scale(1); 
                opacity: 1; 
            }
        }
        .center-dot {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: #ffd700;
            border-radius: 50%;
            border: 5px solid white;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
            z-index: 5;
        }
        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            min-height: 20px;
        }
        .prize-visual-guide {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        .prize-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 1px solid #666;
            cursor: help;
        }
        .prize-dot.active {
            transform: scale(1.5);
            box-shadow: 0 0 8px #ff0000;
            z-index: 2;
        }
        .login-required {
            text-align: center;
            padding: 40px;
        }
        .login-required h3 {
            margin-bottom: 20px;
            color: #ff6b6b;
        }
    </style>
</head>
<body>
    <div class="event-banner">
        <div class="container">
            üéâ THAM GIA S·ª∞ KI·ªÜN ƒê·∫∂C BI·ªÜT - V√íNG QUAY T·ª¨ TH·∫¶N üéâ
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="https://cdn-icons-png.flaticon.com/512/2331/2331941.png" alt="Logo" width="32" class="me-2">
                Smart Hotel Finder
            </a>
            <a href="/" class="btn btn-outline-light">‚Üê Quay l·∫°i Trang ch·ªß</a>
        </div>
    </nav>

    <div class="container">
        <div class="event-container">
            <div class="event-header">
                <h1>üéØ V√≤ng Quay T·ª≠ Th·∫ßn üéØ</h1>
                <p class="lead">Tham gia ngay ƒë·ªÉ nh·∫≠n nh·ªØng ph·∫ßn qu√† h·∫•p d·∫´n!</p>
                <div class="event-timer">
                    <small>Th·ªùi gian s·ª± ki·ªán: 01/08 - 31/12 h√†ng nƒÉm</small>
                </div>
            </div>

            <div class="p-4">
                <div id="event-status" class="mb-4">
                    <!-- Status s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JavaScript -->
                    <div class="card status-card">
                        <div class="card-body">
                            <h5 class="card-title">ƒêang ki·ªÉm tra...</h5>
                            <p class="card-text">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ tham gia</p>
                        </div>
                    </div>
                </div>

                <!-- N√∫t tham gia - s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t -->
                <div class="text-center mb-4" id="action-button-container">
                    <button id="start-wheel" class="btn participate-btn" disabled>
                        üîí ƒêƒÉng nh·∫≠p ƒë·ªÉ tham gia
                    </button>
                </div>

                <!-- N·ªôi dung ch√≠nh -->
                <div class="row">
                    <!-- Th√¥ng tin s·ª± ki·ªán - N·ªòI QUY ƒê√É C·∫¨P NH·∫¨T -->
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-danger text-white">
                                <h5 class="mb-0">üìã N·ªôi Quy Tham Gia</h5>
                            </div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        üîí <strong>B·∫ÆT BU·ªòC: ƒêƒÉng nh·∫≠p ƒë·ªÉ tham gia</strong>
                                    </li>
                                    <li class="list-group-item">
                                        üéÅ <strong>T·∫∂NG NGAY: M·ªói t√†i kho·∫£n ƒë∆∞·ª£c 1 l∆∞·ª£t quay mi·ªÖn ph√≠ ban ƒë·∫ßu</strong>
                                    </li>
                                    <li class="list-group-item">
                                        üìä <strong>T·ªïng chi ti√™u ƒë∆∞·ª£c t√≠nh t·ª´ 01/08 ƒë·∫øn 31/12 h√†ng nƒÉm</strong>
                                    </li>
                                    <li class="list-group-item">
                                        üíé <strong>Th√™m l∆∞·ª£t quay theo h·∫°ng th√†nh vi√™n:</strong>
                                        <br>
                                        <small class="text-muted">
                                            ‚Ä¢ ƒê·ªìng: +1 l∆∞·ª£t<br>
                                            ‚Ä¢ B·∫°c: +2 l∆∞·ª£t<br>
                                            ‚Ä¢ V√†ng: +3 l∆∞·ª£t<br>
                                            ‚Ä¢ B·∫°ch Kim: +4 l∆∞·ª£t
                                        </small>
                                    </li>
                                    <li class="list-group-item">
                                        üí∞ M·ªëc 1: 500,000 VNƒê ‚Üí +1 l∆∞·ª£t quay
                                    </li>
                                    <li class="list-group-item">
                                        üí∞ M·ªëc 2: 1,000,000 VNƒê ‚Üí +2 l∆∞·ª£t quay
                                    </li>
                                    <li class="list-group-item">
                                        üí∞ M·ªëc 3: 2,000,000 VNƒê ‚Üí +3 l∆∞·ª£t quay
                                    </li>
                                    <li class="list-group-item">
                                        üí∞ M·ªëc 4: 3,500,000 VNƒê ‚Üí +4 l∆∞·ª£t quay
                                    </li>
                                    <li class="list-group-item">
                                        üí∞ M·ªëc 5: 5,000,000 VNƒê ‚Üí +5 l∆∞·ª£t quay (t·ªëi ƒëa t·ª´ chi ti√™u)
                                    </li>
                                    <li class="list-group-item">
                                        üí∏ <strong>Gi·∫£i th∆∞·ªüng s·∫Ω ƒë∆∞·ª£c c·ªông TR·ª∞C TI·∫æP v√†o t·ªïng chi ti√™u</strong>
                                    </li>
                                    <li class="list-group-item">
                                        üìà <strong>Gi·∫£i th∆∞·ªüng gi√∫p tƒÉng rank nhanh h∆°n, nh·∫≠n th√™m l∆∞·ª£t quay ti·∫øp theo</strong>
                                    </li>
                                </ul>
                                <div class="alert alert-info mt-3">
                                    <strong>‚ÑπÔ∏è C√¥ng th·ª©c t√≠nh l∆∞·ª£t quay:</strong><br>
                                    T·ªïng l∆∞·ª£t = 1 l∆∞·ª£t mi·ªÖn ph√≠ + L∆∞·ª£t t·ª´ chi ti√™u + L∆∞·ª£t t·ª´ h·∫°ng th√†nh vi√™n
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Gi·∫£i th∆∞·ªüng -->
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">üèÜ Gi·∫£i Th∆∞·ªüng</h5>
                            </div>
                            <div class="card-body">
                                <!-- KH·ªöP V·ªöI SERVER - √î 0-6 -->
                                <div class="prize-item">
                                    <strong>√î 1: Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau</strong>
                                    <span class="badge bg-secondary float-end">40%</span>
                                </div>
                                <div class="prize-item">
                                    <strong>√î 2: Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau</strong>
                                    <span class="badge bg-secondary float-end">25%</span>
                                </div>
                                <div class="prize-item">
                                    <strong>√î 3: Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau</strong>
                                    <span class="badge bg-secondary float-end">15%</span>
                                </div>
                                <div class="prize-item">
                                    <strong>√î 4: 50,000 VNƒê</strong>
                                    <span class="badge bg-primary float-end">10%</span>
                                    <small class="text-success d-block mt-1">üí∏ ƒê∆∞·ª£c c·ªông v√†o t·ªïng chi ti√™u</small>
                                </div>
                                <div class="prize-item">
                                    <strong>√î 5: 100,000 VNƒê</strong>
                                    <span class="badge bg-info float-end">5%</span>
                                    <small class="text-success d-block mt-1">üí∏ ƒê∆∞·ª£c c·ªông v√†o t·ªïng chi ti√™u</small>
                                </div>
                                <div class="prize-item">
                                    <strong>√î 6: 200,000 VNƒê</strong>
                                    <span class="badge bg-warning float-end">3%</span>
                                    <small class="text-success d-block mt-1">üí∏ ƒê∆∞·ª£c c·ªông v√†o t·ªïng chi ti√™u</small>
                                </div>
                                <div class="prize-item">
                                    <strong>√î 7: 500,000 VNƒê</strong>
                                    <span class="badge bg-danger float-end">2%</span>
                                    <small class="text-success d-block mt-1">üí∏ ƒê∆∞·ª£c c·ªông v√†o t·ªïng chi ti√™u</small>
                                </div>
                                <div class="alert alert-warning mt-3">
                                    <strong>üí∞ Gi·∫£i th∆∞·ªüng ti·ªÅn m·∫∑t s·∫Ω ƒë∆∞·ª£c c·ªông TR·ª∞C TI·∫æP v√†o t·ªïng chi ti√™u c·ªßa b·∫°n, gi√∫p:</strong>
                                    <ul class="mb-0 mt-1">
                                        <li>üìà TƒÉng h·∫°ng th√†nh vi√™n nhanh h∆°n</li>
                                        <li>üéÅ Nh·∫≠n th√™m l∆∞·ª£t quay t·ª´ c√°c m·ªëc m·ªõi</li>
                                        <li>‚ú® H∆∞·ªüng ∆∞u ƒë√£i t·ªët h∆°n</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Th√¥ng tin chi ti·∫øt l∆∞·ª£t quay (s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·∫±ng JS) -->
                <div class="card mb-4" id="spin-details" style="display: none;">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üéØ Th√¥ng tin l∆∞·ª£t quay c·ªßa b·∫°n</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th>üë§ T√†i kho·∫£n:</th>
                                        <td id="user-username">-</td>
                                    </tr>
                                    <tr>
                                        <th>üíé H·∫°ng th√†nh vi√™n:</th>
                                        <td><span id="user-rank" class="badge bg-info">-</span></td>
                                    </tr>
                                    <tr>
                                        <th>üí∞ T·ªïng chi ti√™u:</th>
                                        <td><span id="total-spent" class="fw-bold">0 VNƒê</span></td>
                                    </tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <table class="table table-sm">
                                    <tr>
                                        <th>üéÅ L∆∞·ª£t mi·ªÖn ph√≠:</th>
                                        <td><span class="badge bg-success">1 l∆∞·ª£t</span></td>
                                    </tr>
                                    <tr>
                                        <th>üí∞ L∆∞·ª£t t·ª´ chi ti√™u:</th>
                                        <td><span id="spend-spins" class="badge bg-primary">0 l∆∞·ª£t</span></td>
                                    </tr>
                                    <tr>
                                        <th>üíé L∆∞·ª£t t·ª´ h·∫°ng:</th>
                                        <td><span id="rank-bonus" class="badge bg-warning">0 l∆∞·ª£t</span></td>
                                    </tr>
                                    <tr class="table-active">
                                        <th>üéØ T·ªïng l∆∞·ª£t quay:</th>
                                        <td><span id="total-spins" class="badge bg-danger">0 l∆∞·ª£t</span></td>
                                    </tr>
                                    <tr>
                                        <th>üîÑ ƒê√£ s·ª≠ d·ª•ng:</th>
                                        <td><span id="used-spins" class="badge bg-secondary">0 l∆∞·ª£t</span></td>
                                    </tr>
                                    <tr class="table-success">
                                        <th>‚úÖ C√≤n l·∫°i:</th>
                                        <td><span id="spins-remaining" class="badge bg-success fw-bold">0 l∆∞·ª£t</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- L·ª£i √≠ch -->
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">üíé L·ª£i √çch Khi Tham Gia</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>üéÅ Gi·∫£i th∆∞·ªüng:</h6>
                                <ul>
                                    <li>üí∞ Ti·ªÅn th∆∞·ªüng ƒë∆∞·ª£c c·ªông TR·ª∞C TI·∫æP v√†o t·ªïng chi ti√™u</li>
                                    <li>üìà Gi√∫p tƒÉng h·∫°ng th√†nh vi√™n NHANH CH√ìNG</li>
                                    <li>üéØ ƒê·∫°t m·ªëc chi ti√™u ƒë·ªÉ nh·∫≠n TH√äM L∆Ø·ª¢T QUAY</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>‚ú® ∆Øu ƒë√£i th√†nh vi√™n:</h6>
                                <ul>
                                    <li>üíé H·∫°ng c√†ng cao ‚Üí c√†ng nhi·ªÅu l∆∞·ª£t quay</li>
                                    <li>üéÅ Gi·∫£m gi√° ƒë·∫∑t ph√≤ng t·ªët h∆°n</li>
                                    <li>‚≠ê Tr·∫£i nghi·ªám d·ªãch v·ª• cao c·∫•p</li>
                                    <li>üîÑ V√≤ng quay t√≠ch c·ª±c: th∆∞·ªüng ‚Üí tƒÉng rank ‚Üí th√™m l∆∞·ª£t quay</li>
                                </ul>
                            </div>
                        </div>
                        <div class="alert alert-success mt-3">
                            <strong>üöÄ Chi·∫øn l∆∞·ª£c th√¥ng minh:</strong> S·ª≠ d·ª•ng l∆∞·ª£t quay mi·ªÖn ph√≠ ‚Üí Tr√∫ng th∆∞·ªüng ‚Üí TƒÉng t·ªïng chi ti√™u ‚Üí 
                            ƒê·∫°t m·ªëc m·ªõi ‚Üí Nh·∫≠n th√™m l∆∞·ª£t quay ‚Üí Ti·∫øp t·ª•c tham gia!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal V√≤ng Quay -->
    <div class="modal fade" id="wheelModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">üéØ V√≤ng Quay T·ª≠ Th·∫ßn</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="wheel-result" class="alert" style="display: none;"></div>
                    <div class="wheel-container">
                        <div class="center-dot"></div>
                        <div class="wheel-pointer"></div>
                        <div class="wheel" id="prize-wheel"></div>
                    </div>
                    <div class="prize-visual-guide" id="prize-guide"></div>
                    <div class="mt-3">
                        <p id="spin-info" class="fw-bold">L∆∞·ª£t quay c√≤n l·∫°i: <span id="remaining-spins-count">0</span></p>
                        <p class="text-muted small">Th·ªùi gian s·ª± ki·ªán: 01/08 - 31/12</p>
                        <div class="spin-count" id="spin-count">ƒê√£ quay: 0 l·∫ßn</div>
                        <div class="debug-info" id="debug-info"></div>
                        <button id="spin-btn" class="btn participate-btn mt-2">QUAY NGAY</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DANH S√ÅCH GI·∫¢I TH∆Ø·ªûNG - KH·ªöP V·ªöI SERVER (app.py)
            const testPrizes = [
                { name: 'Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau', value: 0, probability: 40, color: '#ff6b6b', index: 0 },     // √î 1: May m·∫Øn (40%)
                { name: '50,000 VNƒê', value: 50000, probability: 10, color: '#4ecdc4', index: 1 },              // √î 2: 50K (10%)
                { name: 'Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau', value: 0, probability: 25, color: '#45b7d1', index: 2 },   // √î 3: May m·∫Øn (25%)
                { name: '100,000 VNƒê', value: 100000, probability: 5, color: '#96ceb4', index: 3 },           // √î 4: 100K (5%)
                { name: 'Ch√∫c b·∫°n may m·∫Øn l·∫ßn sau', value: 0, probability: 15, color: '#f7dc6f', index: 4 },  // √î 5: May m·∫Øn (15%)
                { name: '200,000 VNƒê', value: 200000, probability: 3, color: '#f8c471', index: 5 },          // √î 6: 200K (3%)
                { name: '500,000 VNƒê', value: 500000, probability: 2, color: '#9b59b6', index: 6 }           // √î 7: 500K (2%)
            ];

            let spinCount = 0;
            let isSpinning = false;
            let currentRotation = 0;
            let userSpinsRemaining = 0;
            let currentUser = null;

            // Ki·ªÉm tra tr·∫°ng th√°i ƒëƒÉng nh·∫≠p v√† l∆∞·ª£t quay
            function checkLoginAndSpins() {
                console.log('üîÑ Ki·ªÉm tra tr·∫°ng th√°i...');
                fetch('/event/check-eligibility')
                    .then(response => response.json())
                    .then(data => {
                        console.log('üìä D·ªØ li·ªáu tr·∫£ v·ªÅ:', data);
                        updateUI(data);
                    })
                    .catch(error => {
                        console.error('Error checking eligibility:', error);
                        showLoginRequired();
                    });
            }

            // C·∫≠p nh·∫≠t giao di·ªán d·ª±a tr√™n tr·∫°ng th√°i
            function updateUI(data) {
                const statusCard = document.querySelector('#event-status .card');
                const statusTitle = document.querySelector('#event-status .card-title');
                const statusText = document.querySelector('#event-status .card-text');
                const startBtn = document.getElementById('start-wheel');
                const spinDetails = document.getElementById('spin-details');
                
                if (data.eligible === false && data.message === 'Vui l√≤ng ƒëƒÉng nh·∫≠p') {
                    // Ch∆∞a ƒëƒÉng nh·∫≠p
                    statusCard.className = 'card status-card not-eligible';
                    statusTitle.innerHTML = 'üîí ƒêƒÉng nh·∫≠p ƒë·ªÉ tham gia';
                    statusText.innerHTML = 'B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ tham gia s·ª± ki·ªán';
                    startBtn.innerHTML = 'üîê ƒêƒÉng nh·∫≠p ngay';
                    startBtn.disabled = false;
                    startBtn.onclick = function() { window.location.href = '/login'; };
                    spinDetails.style.display = 'none';
                } 
                else if (data.eligible === false && data.message === 'S·ª± ki·ªán ƒë√£ k·∫øt th√∫c') {
                    // S·ª± ki·ªán ƒë√£ k·∫øt th√∫c
                    statusCard.className = 'card status-card ended';
                    statusTitle.innerHTML = '‚è∞ S·ª± ki·ªán ƒë√£ k·∫øt th√∫c';
                    statusText.innerHTML = 'S·ª± ki·ªán V√≤ng Quay T·ª≠ Th·∫ßn ƒë√£ k·∫øt th√∫c. H·∫πn g·∫∑p l·∫°i nƒÉm sau!';
                    startBtn.innerHTML = '‚è∞ S·ª± ki·ªán ƒë√£ k·∫øt th√∫c';
                    startBtn.disabled = true;
                    spinDetails.style.display = 'none';
                }
                else if (data.eligible === false && !data.has_bookings) {
                    // C√≥ ƒëƒÉng nh·∫≠p nh∆∞ng ch∆∞a c√≥ booking
                    statusCard.className = 'card status-card not-eligible';
                    statusTitle.innerHTML = 'üìã Ch∆∞a ƒë·ªß ƒëi·ªÅu ki·ªán';
                    statusText.innerHTML = 'T√†i kho·∫£n c·ªßa b·∫°n ch∆∞a c√≥ ƒë·∫∑t ph√≤ng n√†o trong th·ªùi gian s·ª± ki·ªán';
                    startBtn.innerHTML = 'üè® ƒê·∫∑t ph√≤ng ngay';
                    startBtn.disabled = false;
                    startBtn.onclick = function() { window.location.href = '/'; };
                    spinDetails.style.display = 'none';
                }
                else if (data.eligible === false && data.spins_remaining === 0) {
                    // ƒê√£ h·∫øt l∆∞·ª£t quay
                    statusCard.className = 'card status-card not-eligible';
                    statusTitle.innerHTML = 'üéØ ƒê√£ h·∫øt l∆∞·ª£t quay';
                    statusText.innerHTML = `B·∫°n ƒë√£ s·ª≠ d·ª•ng h·∫øt ${data.used_spins}/${data.total_spins} l∆∞·ª£t quay`;
                    startBtn.innerHTML = 'üéØ ƒê√£ h·∫øt l∆∞·ª£t quay';
                    startBtn.disabled = true;
                    
                    // Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt
                    updateSpinDetails(data);
                    spinDetails.style.display = 'block';
                }
                else if (data.eligible === true) {
                    // C√≥ th·ªÉ quay
                    statusCard.className = 'card status-card eligible';
                    statusTitle.innerHTML = '‚úÖ S·∫µn s√†ng tham gia!';
                    statusText.innerHTML = `B·∫°n c√≤n ${data.spins_remaining} l∆∞·ª£t quay. H√£y th·ª≠ v·∫≠n may!`;
                    startBtn.innerHTML = 'üéÆ B·∫Øt ƒê·∫ßu V√≤ng Quay';
                    startBtn.disabled = false;
                    startBtn.onclick = function() { 
                        const modal = new bootstrap.Modal(document.getElementById('wheelModal'));
                        modal.show();
                        setTimeout(() => { createPrizeLabels(); }, 100);
                    };
                    
                    // L∆∞u th√¥ng tin
                    userSpinsRemaining = data.spins_remaining;
                    currentUser = data.username;
                    
                    // C·∫≠p nh·∫≠t th√¥ng tin chi ti·∫øt
                    updateSpinDetails(data);
                    spinDetails.style.display = 'block';
                    
                    // C·∫≠p nh·∫≠t modal
                    document.getElementById('remaining-spins-count').textContent = data.spins_remaining;
                    
                    console.log(`‚úÖ User ${currentUser} c√≥ ${userSpinsRemaining} l∆∞·ª£t quay`);
                }
            }

            // C·∫≠p nh·∫≠t th√¥ng tin chi ti·∫øt l∆∞·ª£t quay
            function updateSpinDetails(data) {
                if (data.username) document.getElementById('user-username').textContent = data.username;
                if (data.rank) document.getElementById('user-rank').textContent = data.rank;
                if (data.total_spent) document.getElementById('total-spent').textContent = data.total_spent.toLocaleString() + ' VNƒê';
                if (data.spend_spins !== undefined) document.getElementById('spend-spins').textContent = data.spend_spins + ' l∆∞·ª£t';
                if (data.rank_bonus !== undefined) document.getElementById('rank-bonus').textContent = data.rank_bonus + ' l∆∞·ª£t';
                if (data.total_spins !== undefined) document.getElementById('total-spins').textContent = data.total_spins + ' l∆∞·ª£t';
                if (data.used_spins !== undefined) document.getElementById('used-spins').textContent = data.used_spins + ' l∆∞·ª£t';
                if (data.spins_remaining !== undefined) document.getElementById('spins-remaining').textContent = data.spins_remaining + ' l∆∞·ª£t';
            }

            // Hi·ªÉn th·ªã y√™u c·∫ßu ƒëƒÉng nh·∫≠p
            function showLoginRequired() {
                const statusCard = document.querySelector('#event-status .card');
                const statusTitle = document.querySelector('#event-status .card-title');
                const statusText = document.querySelector('#event-status .card-text');
                const startBtn = document.getElementById('start-wheel');
                
                statusCard.className = 'card status-card not-eligible';
                statusTitle.innerHTML = 'üîí Y√™u c·∫ßu ƒëƒÉng nh·∫≠p';
                statusText.innerHTML = 'Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ tham gia s·ª± ki·ªán';
                startBtn.innerHTML = 'üîê ƒêƒÉng nh·∫≠p ngay';
                startBtn.disabled = false;
                startBtn.onclick = function() { window.location.href = '/login'; };
            }

            // T·∫°o nh√£n gi·∫£i th∆∞·ªüng
            function createPrizeLabels() {
                const wheel = document.getElementById('prize-wheel');
                const guide = document.getElementById('prize-guide');
                wheel.innerHTML = '';
                guide.innerHTML = '';
                
                const numPrizes = testPrizes.length;
                const sectorAngle = 360 / numPrizes; // 51.43 ƒë·ªô m·ªói √¥
                const radius = 185;
                
                // G√≥c b·∫Øt ƒë·∫ßu: -90 ƒë·ªô ƒë·ªÉ √¥ ƒë·∫ßu ti√™n ·ªü tr√™n c√πng
                const startAngle = -90;
                
                console.log(`üéØ T·∫°o ${numPrizes} nh√£n gi·∫£i th∆∞·ªüng, m·ªói √¥ ${sectorAngle} ƒë·ªô`);

                testPrizes.forEach((prize, index) => {
                    // T√≠nh g√≥c t√¢m c·ªßa √¥ (t√≠nh t·ª´ startAngle)
                    const centerAngle = startAngle + (index * sectorAngle) + (sectorAngle / 2);
                    const angleRad = centerAngle * Math.PI / 180;
                    
                    // V·ªã tr√≠ nh√£n (t·ª´ t√¢m ra ngo√†i)
                    const offsetX = Math.cos(angleRad) * (radius - 70);
                    const offsetY = Math.sin(angleRad) * (radius - 70);
                    
                    const label = document.createElement('div');
                    label.className = 'prize-label';
                    label.dataset.index = index;
                    label.dataset.prizeName = prize.name;
                    
                    label.style.left = `calc(50% + ${offsetX}px)`;
                    label.style.top = `calc(50% + ${offsetY}px)`;
                    
                    // Xoay nh√£n ƒë·ªÉ d·ªÖ ƒë·ªçc
                    label.style.transform = `translate(-50%, -50%) rotate(${centerAngle}deg)`;
                    
                    if (prize.value === 0) {
                        label.classList.add('special');
                        label.textContent = 'May m·∫Øn l·∫ßn sau';
                        label.style.fontSize = '10px';
                        label.style.width = '100px';
                        label.style.lineHeight = '1.2';
                    } else {
                        label.textContent = `${(prize.value / 1000).toFixed(0)}K VNƒê`;
                        label.style.fontSize = '12px';
                        label.style.width = '80px';
                    }
                    
                    wheel.appendChild(label);
                    
                    // T·∫°o dot h∆∞·ªõng d·∫´n
                    const dot = document.createElement('div');
                    dot.className = 'prize-dot';
                    dot.style.backgroundColor = prize.color;
                    dot.dataset.index = index;
                    dot.title = `√î ${index + 1}: ${prize.name}`;
                    guide.appendChild(dot);
                });
                
                console.log('‚úÖ ƒê√£ t·∫°o xong nh√£n gi·∫£i th∆∞·ªüng');
            }

            // T√≠nh g√≥c d·ª´ng CH√çNH X√ÅC
            function calculateStopAngle(prizeIndex) {
                const numPrizes = 7;
                const sectorAngle = 360 / numPrizes;
                
                // G√≥c b·∫Øt ƒë·∫ßu c·ªßa √¥ ƒë·∫ßu ti√™n (c√≥ th·ªÉ c·∫ßn ƒëi·ªÅu ch·ªânh)
                const startAngle = 0; // ho·∫∑c 0, 90, -45 t√πy v√†o thi·∫øt k·∫ø
                
                // G√≥c t√¢m c·ªßa √¥ gi·∫£i th∆∞·ªüng
                const prizeCenterAngle = startAngle + (prizeIndex * sectorAngle) + (sectorAngle / 2);
                
                // G√≥c quay ƒë·ªÉ ƒë∆∞a √¥ ƒë√≥ l√™n v·ªã tr√≠ m≈©i t√™n (0¬∞)
                let stopAngle = 360 - (prizeCenterAngle % 360);
                
                // Th√™m √≠t nh·∫•t 3 v√≤ng
                stopAngle += 3 * 360;
                
                return stopAngle;
            }

            // X·ª≠ l√Ω quay
            document.getElementById('spin-btn').addEventListener('click', function() {
                if (isSpinning) {
                    console.log('‚è≥ ƒêang quay, vui l√≤ng ch·ªù...');
                    return;
                }
                
                // Ki·ªÉm tra l∆∞·ª£t quay
                if (userSpinsRemaining <= 0) {
                    alert('B·∫°n ƒë√£ h·∫øt l∆∞·ª£t quay!');
                    return;
                }
                
                const btn = this;
                const wheel = document.getElementById('prize-wheel');
                const resultDiv = document.getElementById('wheel-result');
                const spinCountElement = document.getElementById('spin-count');
                const debugElement = document.getElementById('debug-info');
                const remainingSpinsElement = document.getElementById('remaining-spins-count');
                
                isSpinning = true;
                btn.disabled = true;
                btn.innerHTML = 'üéØ ƒêang x·ª≠ l√Ω...';
                
                console.log('üîÑ G·ª≠i request quay t·ªõi server...');
                
                // G·ª≠i request ƒë·∫øn server ƒë·ªÉ quay
                fetch('/event/spin-wheel', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    console.log('üìä Server response:', data);
                    
                    if (data.error) {
                        alert(data.error);
                        isSpinning = false;
                        btn.disabled = false;
                        btn.innerHTML = 'QUAY NGAY';
                        return;
                    }
                    
                    // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£t quay
                    userSpinsRemaining = data.spins_remaining;
                    remainingSpinsElement.textContent = userSpinsRemaining;
                    
                    spinCount++;
                    spinCountElement.textContent = `ƒê√£ quay: ${spinCount} l·∫ßn`;
                    
                    resultDiv.style.display = 'none';
                    debugElement.textContent = '';
                    
                    // T√¨m index gi·∫£i th∆∞·ªüng trong testPrizes
                    const prizeIndex = testPrizes.findIndex(p => p.value === data.prize_value);
                    
                    console.log(`üé≤ Server prize: ${data.prize_name} (${data.prize_value}), Index: ${prizeIndex}`);
                    
                    if (prizeIndex === -1) {
                        console.error('‚ùå Kh√¥ng t√¨m th·∫•y gi·∫£i th∆∞·ªüng trong testPrizes');
                        alert('L·ªói: Gi·∫£i th∆∞·ªüng kh√¥ng kh·ªõp!');
                        isSpinning = false;
                        btn.disabled = false;
                        btn.innerHTML = 'QUAY NGAY';
                        return;
                    }
                    
                    // T√≠nh g√≥c quay
                    const stopAngle = calculateStopAngle(prizeIndex);
                    
                    // Reset wheel
                    wheel.style.transition = 'none';
                    wheel.style.transform = `rotate(0deg)`;
                    
                    void wheel.offsetWidth;
                    
                    // B·∫Øt ƒë·∫ßu animation
                    wheel.style.transition = `transform 4.5s cubic-bezier(0.25, 0.1, 0.25, 1)`;
                    wheel.style.transform = `rotate(${stopAngle}deg)`;
                    
                    currentRotation = stopAngle % 360;
                    
                    // Hi·ªÉn th·ªã k·∫øt qu·∫£ sau khi quay xong
                    setTimeout(() => {
                        showPrizeResult(data.prize_name, data.prize_value, prizeIndex);
                        
                        // C·∫≠p nh·∫≠t UI sau khi quay
                        setTimeout(() => {
                            console.log('üîÑ C·∫≠p nh·∫≠t UI sau khi quay...');
                            checkLoginAndSpins();
                        }, 2000);
                        
                        setTimeout(() => {
                            isSpinning = false;
                            btn.disabled = false;
                            btn.innerHTML = 'QUAY NGAY';
                            console.log('‚úÖ S·∫µn s√†ng quay ti·∫øp');
                        }, 1000);
                        
                    }, 4500);
                })
                .catch(error => {
                    console.error('Error spinning wheel:', error);
                    alert('C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!');
                    isSpinning = false;
                    btn.disabled = false;
                    btn.innerHTML = 'QUAY NGAY';
                });
            });

            // Hi·ªÉn th·ªã k·∫øt qu·∫£
            function showPrizeResult(prizeName, prizeValue, prizeIndex) {
                const resultDiv = document.getElementById('wheel-result');
                const dots = document.querySelectorAll('.prize-dot');
                
                resultDiv.style.display = 'block';
                
                // Highlight dot t∆∞∆°ng ·ª©ng
                dots.forEach(dot => dot.classList.remove('active'));
                
                if (dots[prizeIndex]) {
                    dots[prizeIndex].classList.add('active');
                }
                
                // Hi·ªÉn th·ªã th√¥ng b√°o k·∫øt qu·∫£
                if (prizeValue > 0) {
                    resultDiv.className = 'alert alert-success result-animation';
                    resultDiv.innerHTML = `
                        <h4 class="mb-2">üéâ CH√öC M·ª™NG!</h4>
                        <p class="mb-1">M≈©i t√™n ch·ªâ v√†o:</p>
                        <h3 class="text-success">${prizeValue.toLocaleString()} VNƒê</h3>
                        <p class="small">${prizeName} (√î s·ªë ${prizeIndex + 1})</p>
                        <div class="alert alert-info mt-2 mb-0">
                            <strong>üí∞ Gi·∫£i th∆∞·ªüng ƒë√£ ƒë∆∞·ª£c c·ªông v√†o t·ªïng chi ti√™u c·ªßa b·∫°n!</strong><br>
                            T·ªïng chi ti√™u m·ªõi: <strong>${document.getElementById('total-spent').textContent}</strong>
                        </div>
                    `;
                } else {
                    resultDiv.className = 'alert alert-warning result-animation';
                    resultDiv.innerHTML = `
                        <h4 class="mb-2">üí´ CH√öC B·∫†N MAY M·∫ÆN L·∫¶N SAU!</h4>
                        <p class="mb-1">M≈©i t√™n ch·ªâ v√†o:</p>
                        <h4 class="text-warning">${prizeName}</h4>
                        <p class="small text-muted">(√î s·ªë ${prizeIndex + 1})</p>
                        <div class="alert alert-secondary mt-2 mb-0">
                            <strong>üéØ B·∫°n c√≤n ${userSpinsRemaining} l∆∞·ª£t quay</strong><br>
                            H√£y th·ª≠ l·∫°i ·ªü l∆∞·ª£t ti·∫øp theo!
                        </div>
                    `;
                }
                
                console.log(`üèÜ K·∫øt qu·∫£: ${prizeName}, Index: ${prizeIndex}, √î s·ªë: ${prizeIndex + 1}`);
            }

            // Ki·ªÉm tra ngay khi trang t·∫£i
            checkLoginAndSpins();

            // T·ª± ƒë·ªông refresh th√¥ng tin m·ªói 30 gi√¢y
            setInterval(checkLoginAndSpins, 30000);
            
            // Debug: log ra th√¥ng tin
            console.log('‚úÖ Event page loaded successfully');
            console.log('üéØ Prize list:', testPrizes.map((p, i) => `√î ${i + 1}: ${p.name} (${p.value} VNƒê)`));
        });
    </script>
</body>
</html>
